# README

**The Compile Design Project of GUET**

## PL/0语言语法的EBNF描述

| PL/0语法单位   | EBNF描述                                                     | 改写符号 |
| -------------- | ------------------------------------------------------------ | -------- |
| <程序>         | ::=<分程序>.                                                 | P        |
| <分程序>       | ::= [<常量说明部分>]  [<变量说明部分>] [<过程说明部分>] <语句> | P'       |
| <常量说明部分> | ::=const<常量定义>{,<常量定义>};                             | I        |
| <常量定义>     | ::=<标识符>=<无符号整数>                                     | D        |
| <变量说明部分> | ::=var<标识符>{,<标识符>};                                   | V        |
| <过程说明部分> | ::=<过程首部><分程序>{;<过程说明部分>};                      | I'       |
| <过程首部>     | ::=procedure<标识符>;                                        | A        |
| <语句>         | ::=<赋值语句>\|<条件语句>\|<当型循环语句>\|<过程调用语句>\|<读语句>\|<写语句>\|<复合语句>\|<空语句> | S        |
| <赋值语句>     | ::=<标识符>:=<表达式>                                        | S'       |
| <复合语句>     | ::=begin<语句>{;<语句>}end                                   | F        |
| <空语句>       | ::=ɛ                                                         | E'       |
| <条件>         | ::=<表达式><关系运算符><表达式>\|odd<表达式>                 | C'       |
| <表达式>       | ::=[+\|-]<项>{<加减运算符><项>}                              | E        |
| <项>           | ::=<因子>{<乘除运算符><因子>}                                | T        |
| <因子>         | ::=<标识符>\|<无符号整数>\|’（’<表达式>’）’                  | T'       |
| <加减运算符>   | ::=+\|-                                                      | L        |
| <乘除运算符>   | ::=*\|/                                                      | M        |
| <关系运算符>   | ::==\|#\|<\|<=\|>\|>=                                        | R        |
| <条件语句>     | ::=if<条件>then<语句>                                        | C        |
| <过程调用语句> | ::=call<标识符>                                              | V'       |
| <当型循环语句> | ::=while<条件>do<语句>                                       | W        |
| <读语句>       | ::=read’（’<标识符>{,<标识符>}’）’                           | H        |
| <写语句>       | ::=write’（’<表达式>{,<表达式>}’）’                          | D'       |

| EBNF描述     | 改写符号 |
| ------------ | -------- |
| <标识符>     | b        |
| <无符号整数> | n        |
| const        | c        |
| var          | v        |
| procedure    | p        |
| begin        | s        |
| end          | e        |
| if           | i        |
| then         | t        |
| call         | r        |
| while        | w        |
| do           | d        |
| read         | y        |
| write        | z        |
| #            | ~        |
| >=           | g        |
| <=           | l        |
| :=           | x        |
| odd          | o        |

| 产生式左端 | 产生式右端                               |
| ---------- | ---------------------------------------- |
| P          | P'.                                      |
| P'         | IVI'S                                    |
| I          | cDA' \| ε                                |
| D          | b=n \| ε                                 |
| V          | vbB' \| ε                                |
| A'         | ,DA' \| ε                                |
| B'         | ,bB' \| ε                                |
| I'         | AP'Z                                     |
| Z          | ;I'Z \| ε                                |
| A          | pb                                       |
| S          | S' \| C \| W \| V' \| C \| D' \| F \| E' |
| S'         | bxE                                      |
| F          | bSYe                                     |
| Y          | ;SY \| ε                                 |
| E'         | ε                                        |
| C'         | ERE \| oE                                |
| E          | XTX'                                     |
| X          | + \| - \| ε                              |
| X'         | +TX' \| -TX' \| ε                        |
| T          | T'Y'                                     |
| Y'         | MY' \| ε                                 |
| T'         | b \| n \| (E)                            |
| L          | + \| -                                   |
| M          | * \| /                                   |
| R          | = \| ~ \| < \| l \| > \| g               |
| C          | iC'tS                                    |
| V'         | rb                                       |
| W          | wC'dS                                    |
| C          | c(bU)                                    |
| D'         | z(EU')                                   |
| U          | ,bU \| ε                                 |
| U'         | ,EU' \| ε                                |

## 四元式

在使用递归下降的方式进行语义分析时，四元式的产生规律通常如下：

1. 当**遇到表达式**时，递归向下分析子表达式，并将子表达式的计算结果存储到临时变量中。
2. 当**遇到赋值语句**时，将赋值符号左侧的变量名作为目标操作数，将右侧的表达式计算结果作为源操作数，生成一个赋值操作的四元式。
3. 当**遇到条件语句**时，先计算条件表达式的结果，根据结果跳转到相应的标号，生成跳转操作的四元式。
4. 当**遇到循环语句**时，生成一个标号作为循环的起始点，并计算循环条件表达式的结果，根据结果跳转到循环终止标号或者继续执行循环体，生成跳转操作的四元式。
5. 当**遇到函数调用**时，将函数名作为操作符，函数参数作为操作数，生成一个函数调用操作的四元式。
6. 当**遇到返回语句**时，将返回值作为操作数，生成一个返回操作的四元式。

| **编号** | **四元式代码**           | **含义**                      |
| -------- | ------------------------ | ----------------------------- |
| (1)      | (syss, __ ，__ ，__)     | 程序开始（system start）      |
| (2)      | (syse，__ ，__ ，__)     | 程序结束（system end）        |
| (3)      | (const,ident, __ ,__)    | 声明标识符ident（常量）       |
| (4)      | (var,ident, __ ,__)      | 声明标识符ident（变量）       |
| (5)      | (procedure,ident,__ ,__) | 声明标识符ident（函数）       |
| (6)      | (+,A,B,T)                | 加法运算，将A+B的结果赋给T    |
| (7)      | (-,A,B,T)                | 减法运算，将A-B的结果赋给T    |
| (8)      | (*,A,B,T)                | 乘法运算，将A*B的结果赋给T    |
| (9)      | (/,A,B,T)                | 除法运算，将A/B的结果赋给T    |
| (10)     | (<,A,B,T)                | 小于，将A<B的结果赋给T        |
| (11)     | (<=,A,B,T)               | 小于或等于，将A<=B的结果赋给T |
| (12)     | (>,A,B,T)                | 大于，将A>B的结果赋给T        |
| (13)     | (>=,A,B,T)               | 大于或等于，将A>=B的结果赋给T |
| (14)     | (#,A,B,T)                | 不等于，将A#B的结果赋给T      |
| (15)     | (=,A,B,T)                | 等于，将A=B的结果赋给T        |
| (16)     | (=,A , __ , T)           | 将A（的值）赋给常量T          |
| (17)     | (:=,A,__,T)              | 将A（的值）赋给变量T          |
| (18)     | (jrop,A,B,P)             | 当A rop B为真时跳转到四元式P  |
| (19)     | (read,A, __ , __)        | 为变量A输入值                 |
| (20)     | (write,A, __ , __)       | 输出A的值                     |
| (21)     | (call,fun, __ ,A)        | 调用fun函数，返回值存入变量A  |
| (22)     | (call,fun, __ , __)      | 调用fun函数，不保存返回值     |
| (23)     | (ret,A, __ , __)         | 返回返回值A                   |
| (24)     | (ret,__ , __ ,__)        | 返回，无返回值                |

## 数据结构及其全局参数

```c++
struct Lex_Symbol{ 
	string symbol_record;		    //储存保留字，标识符，运算符等 
	int count_lines_num;			//储存行号 
};

struct Quad{	//四元式 
	string type;
	string op1;
	string op2;
	string result;
}; 

struct table{	//符号表 
	string kind;
	string name;
	string size;
}; 

int record_idx = 0;	// 存放toekn的下标 
int read_idx = 0;		// 读取token的下标 
int quad_idx=0;		// 四元式的索引 
int tab=0; 			// 符号表的索引 

int semantic=1;		// 若为1则表示程序语义正确，为0表示语义错误
int if_true;			// 程序的if判断语句正确时执行语句的行数
int if_false;			// 程序的if判断语句错误时执行语句的行数
int while_true;		// 程序的while判断语句正确时执行语句的行数
int while_false;		// 程序的while判断语句正确时执行语句的行数

```

## **测试**

```c++
const a = 10;
var b, c;

//单行注释

/*
* 多行注释
*/

procedure p;
    if a <= 10 then
        begin
            c := b + a;
        end;
begin
    read(b);
    while b # 0 do
        begin
            call p;
            write(2 * c);
            read(b);
        end;
end.
```

**result**

```#
语义正确
中间代码:
(1)(syss,_,_,_)
(2)(const,a,_,_)
(3)(=,10,_,a)
(4)(var,b,_,_)
(5)(var,c,_,_)
(6)(procedure,p,_,_)
(7)(j<=,a,10,$8)
(8)(+,b,a,c)
(9)(ret,_,_,_)
(10)(read,b,_,_)
(11)(j#,b,0,$13)
(12)(j=,b,0,$17)
(13)(call,p,_,_)
(14)(*,2,c,T1)
(15)(write,T1,_,_)
(16)(read,b,_,_)
(17)(syse,_,_,_)
符号表:
const a 10
var b 0
var c 0
procedure p
```

